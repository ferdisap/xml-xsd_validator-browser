var y=function(a,t,n,e,s,l){function r(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=e.kind,c=o==="getter"?"get":o==="setter"?"set":"value",m=!t&&a?e.static?a:a.prototype:null,h=t||(m?Object.getOwnPropertyDescriptor(m,e.name):{}),p,q=!1,k=n.length-1;k>=0;k--){var g={};for(var b in e)g[b]=b==="access"?{}:e[b];for(var b in e.access)g.access[b]=e.access[b];g.addInitializer=function(w){if(q)throw new TypeError("Cannot add initializers after decoration has completed");l.push(r(w||null))};var P=(0,n[k])(o==="accessor"?{get:h.get,set:h.set}:h[c],g);if(o==="accessor"){if(P===void 0)continue;if(P===null||typeof P!="object")throw new TypeError("Object expected");(p=r(P.get))&&(h.get=p),(p=r(P.set))&&(h.set=p),(p=r(P.init))&&s.unshift(p)}else(p=r(P))&&(o==="field"?s.unshift(p):h[c]=p)}m&&Object.defineProperty(m,e.name,h),q=!0},v=function(a,t,n){for(var e=arguments.length>2,s=0;s<t.length;s++)n=e?t[s].call(a,n):t[s].call(a);return e?n:void 0},x=function(a,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(a,"name",{configurable:!0,value:n?"".concat(n," ",t):t})};import{XmlDocument as ne}from"./document.mjs";import{XmlError as _,XmlNamedNodeStruct as J,XmlNodeSetStruct as E,XmlNodeStruct as i,XmlNsStruct as f,XmlXPathObjectStruct as d,xmlAddChild as N,xmlAddNextSibling as T,xmlAddPrevSibling as X,xmlFreeNode as re,xmlGetNsList as ae,xmlHasNsProp as se,xmlNewCDataBlock as M,xmlNewDocComment as L,xmlNewDocNode as oe,xmlNewDocText as I,xmlNewNs as le,xmlNewReference as z,xmlNodeGetContent as ie,xmlNodeSetContent as K,xmlRemoveProp as ce,xmlSaveClose as de,xmlSaveOption as ue,xmlSaveSetIndentString as me,xmlSaveToIO as pe,xmlSaveTree as _e,xmlSearchNs as Q,xmlSetNs as fe,xmlSetNsProp as he,xmlUnlinkNode as Pe,xmlXPathCompiledEval as be,xmlXPathFreeContext as ye,xmlXPathFreeObject as H,xmlXPathNewContext as ve,xmlXPathRegisterNs as xe,xmlXPathSetContextNode as Se}from"./libxml2.mjs";import{XmlStringOutputBufferHandler as we}from"./utils.mjs";import{XmlXPath as B}from"./xpath.mjs";function Ne(a,t){const n=ve(i.doc(a));t.namespaces&&Object.entries(t.namespaces).forEach(([s,l])=>{xe(n,s,l)}),Se(a,n);const e=be(t._ptr,n);return ye(n),e}function W(a,t,n){const e=t instanceof B?t:B.compile(t,n),s=Ne(a,e);return t instanceof B||e.dispose(),s}const Z=new Map;function S(a){return function(n,e){return Z.set(a,n),n}}function U(a){const t=i.type(a),n=Z.get(t);if(!n)throw new _(`Unsupported node type ${t}`);return new n(a)}function D(a){return a?U(a):null}function u(a,t,n,e){let s=n(i.doc(a),t);return s=e(a,s),s}function $(a,t){const n=Q(i.doc(a),a,t||null);if(!n&&t)throw new _(`Namespace prefix "${t}" not found`);return n}function G(a,t,n){const e=$(a,n);return oe(i.doc(a),e,t)}class ee{constructor(t){this._nodePtr=t}get doc(){return ne.getInstance(i.doc(this._nodePtr))}remove(){this._nodePtr&&(Pe(this._nodePtr),re(this._nodePtr),this._nodePtr=0)}get parent(){const t=i.parent(this._nodePtr);return!t||t===i.doc(this._nodePtr)?null:new O(t)}get content(){return ie(this._nodePtr)}get line(){return i.line(this._nodePtr)}get(t,n){const e=W(this._nodePtr,t,n);let s;if(d.type(e)!==d.Type.XPATH_NODESET)throw H(e),new _("XPath selector must return a node set");const l=d.nodesetval(e);return l===0||E.nodeCount(l)===0?s=null:s=U(E.nodeTable(l,1)[0]),H(e),s}find(t,n){const e=this.eval(t,n);if(Array.isArray(e))return e;throw new _("XPath selector must return a node set")}eval(t,n){const e=W(this._nodePtr,t,n);try{switch(d.type(e)){case d.Type.XPATH_NODESET:{const s=[],l=d.nodesetval(e),r=E.nodeCount(l),o=E.nodeTable(l,r);for(let c=0;c<r;c+=1)s.push(U(o[c]));return s}case d.Type.XPATH_NUMBER:return d.floatval(e);case d.Type.XPATH_BOOLEAN:return d.boolval(e)!==0;case d.Type.XPATH_STRING:return d.stringval(e);default:throw new _(`XPath selector returned an unsupported type: ${d.type(e)}`)}}finally{H(e)}}}class V extends ee{appendComment(t){return new A(u(this._nodePtr,t,L,T))}prependComment(t){return new A(u(this._nodePtr,t,L,X))}appendCData(t){return new j(u(this._nodePtr,t,M,T))}prependCData(t){return new j(u(this._nodePtr,t,M,X))}appendElement(t,n){const e=G(this._nodePtr,t,n);return T(this._nodePtr,e),new O(e)}prependElement(t,n){const e=G(this._nodePtr,t,n);return X(this._nodePtr,e),new O(e)}appendText(t){return new R(u(this._nodePtr,t,I,T))}prependText(t){return new R(u(this._nodePtr,t,I,X))}appendEntityReference(t){return new F(u(this._nodePtr,t,z,T))}prependEntityReference(t){return new F(u(this._nodePtr,t,z,X))}get next(){const t=i.next(this._nodePtr);return D(t)}get prev(){const t=i.prev(this._nodePtr);return D(t)}}function te(a,t){Object.defineProperties(a.prototype,{namespaces:{get(){return ae(i.doc(this._nodePtr),this._nodePtr).reduce((n,e)=>({...n,[f.prefix(e)]:f.href(e)}),{})}},namespaceForPrefix:{value(n){const e=Q(i.doc(this._nodePtr),this._nodePtr,n);return e?f.href(e):null}},name:{get(){return i.name_(this._nodePtr)}},namespaceUri:{get(){const n=J.namespace(this._nodePtr);return n?f.href(n):""}},namespacePrefix:{get(){return this.prefix},set(n){this.prefix=n}},prefix:{get(){const n=J.namespace(this._nodePtr);return n?f.prefix(n):""},set(n){const e=$(this._nodePtr,n);fe(this._nodePtr,e)}}})}let O=(()=>{let a=[S(i.Type.XML_ELEMENT_NODE),te],t,n=[],e,s=V;var l=e=class extends s{get firstChild(){const r=i.children(this._nodePtr);return D(r)}get lastChild(){const r=i.last(this._nodePtr);return D(r)}get attrs(){const r=[];for(let o=i.properties(this._nodePtr);o;o=i.next(o))r.push(new C(o));return r}get nsDeclarations(){const r={};for(let o=i.nsDef(this._nodePtr);o;o=f.next(o))r[f.prefix(o)]=f.href(o);return r}get localNamespaces(){return this.nsDeclarations}addNsDeclaration(r,o){if(!le(this._nodePtr,r,o))throw new _(`Failed to add namespace declaration "${o}"`)}addLocalNamespace(r,o){this.addNsDeclaration(r,o)}attr(r,o){const c=o?this.namespaceForPrefix(o):null,m=se(this._nodePtr,r,c);return m?new C(m):null}setAttr(r,o,c){const m=$(this._nodePtr,c);return new C(he(this._nodePtr,m,r,o))}addComment(r){return new A(u(this._nodePtr,r,L,N))}addCData(r){return new j(u(this._nodePtr,r,M,N))}addElement(r,o){const c=G(this._nodePtr,r,o);return N(this._nodePtr,c),new l(c)}addText(r){return new R(u(this._nodePtr,r,I,N))}addEntityReference(r){return new F(u(this._nodePtr,r,z,N))}save(r,o){const c=pe(r,null,ue(o));if(o?.indentString&&me(c,o.indentString)<0)throw new _("Failed to set indent string");_e(c,this._nodePtr),de(c)}toString(r){const o=new we;return this.save(o,r),o.result}};return x(e,"XmlElement"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})(),C=(()=>{let a=[S(i.Type.XML_ATTRIBUTE_NODE),te],t,n=[],e,s=ee;var l=e=class extends s{remove(){if(this._nodePtr){if(ce(this._nodePtr))throw new _("Failed to remove attribute");this._nodePtr=0}}get value(){return super.content}set value(r){K(this._nodePtr,r)}get content(){return this.value}set content(r){this.value=r}};return x(e,"XmlAttribute"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})();class Y extends V{get content(){return super.content}set content(t){K(this._nodePtr,t)}}let j=(()=>{let a=[S(i.Type.XML_CDATA_SECTION_NODE)],t,n=[],e,s=Y;var l=e=class extends s{};return x(e,"XmlCData"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})(),A=(()=>{let a=[S(i.Type.XML_COMMENT_NODE)],t,n=[],e,s=Y;var l=e=class extends s{};return x(e,"XmlComment"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})(),R=(()=>{let a=[S(i.Type.XML_TEXT_NODE)],t,n=[],e,s=Y;var l=e=class extends s{};return x(e,"XmlText"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})(),F=(()=>{let a=[S(i.Type.XML_ENTITY_REF_NODE)],t,n=[],e,s=V;var l=e=class extends s{get name(){return i.name_(this._nodePtr)}};return x(e,"XmlEntityReference"),(()=>{const r=typeof Symbol=="function"&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;y(null,t={value:e},a,{kind:"class",name:e.name,metadata:r},null,n),l=e=t.value,r&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:r}),v(e,n)})(),l=e})();export{C as XmlAttribute,j as XmlCData,A as XmlComment,O as XmlElement,F as XmlEntityReference,ee as XmlNode,Y as XmlSimpleNode,R as XmlText,V as XmlTreeNode,S as forNodeType};
