var T=function(e,l,E,_,n,A){function t(a){if(a!==void 0&&typeof a!="function")throw new TypeError("Function expected");return a}for(var r=_.kind,o=r==="getter"?"get":r==="setter"?"set":"value",S=!l&&e?_.static?e:e.prototype:null,c=l||(S?Object.getOwnPropertyDescriptor(S,_.name):{}),X,i=!1,f=E.length-1;f>=0;f--){var u={};for(var s in _)u[s]=s==="access"?{}:_[s];for(var s in _.access)u.access[s]=_.access[s];u.addInitializer=function(a){if(i)throw new TypeError("Cannot add initializers after decoration has completed");A.push(t(a||null))};var R=(0,E[f])(r==="accessor"?{get:c.get,set:c.set}:c[o],u);if(r==="accessor"){if(R===void 0)continue;if(R===null||typeof R!="object")throw new TypeError("Object expected");(X=t(R.get))&&(c.get=X),(X=t(R.set))&&(c.set=X),(X=t(R.init))&&n.unshift(X)}else(X=t(R))&&(r==="field"?n.unshift(X):c[o]=X)}S&&Object.defineProperty(S,_.name,c),i=!0},v=function(e,l,E){for(var _=arguments.length>2,n=0;n<l.length;n++)E=_?l[n].call(e,E):l[n].call(e);return _?E:void 0},x=function(e,l,E){return typeof l=="symbol"&&(l=l.description?"[".concat(l.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:E?"".concat(E," ",l):l})};import{error as L,xmlCtxtSetErrorHandler as w,xmlDocGetRootElement as y,xmlDocSetRootElement as P,XmlError as N,xmlFreeDoc as M,xmlFreeNode as b,xmlFreeParserCtxt as F,xmlGetIntSubset as D,XmlLibError as G,xmlNewDoc as B,xmlNewDocNode as U,xmlNewParserCtxt as j,xmlReadMemory as k,xmlReadString as H,xmlSaveClose as V,xmlSaveDoc as z,xmlSaveOption as K,xmlSaveSetIndentString as W,xmlSaveToIO as Y,xmlXIncludeFreeContext as Z,xmlXIncludeNewContext as q,xmlXIncludeProcessNode as J,xmlXIncludeSetErrorHandler as Q}from"./libxml2.mjs";import{XmlElement as g}from"./nodes.mjs";import{disposeBy as $,XmlDisposable as O}from"./disposable.mjs";import{XmlDtd as h}from"./dtd.mjs";import{XmlStringOutputBufferHandler as p}from"./utils.mjs";var m;(function(e){e[e.XML_PARSE_DEFAULT=0]="XML_PARSE_DEFAULT",e[e.XML_PARSE_RECOVER=1]="XML_PARSE_RECOVER",e[e.XML_PARSE_NOENT=2]="XML_PARSE_NOENT",e[e.XML_PARSE_DTDLOAD=4]="XML_PARSE_DTDLOAD",e[e.XML_PARSE_DTDATTR=8]="XML_PARSE_DTDATTR",e[e.XML_PARSE_DTDVALID=16]="XML_PARSE_DTDVALID",e[e.XML_PARSE_NOERROR=32]="XML_PARSE_NOERROR",e[e.XML_PARSE_NOWARNING=64]="XML_PARSE_NOWARNING",e[e.XML_PARSE_PEDANTIC=128]="XML_PARSE_PEDANTIC",e[e.XML_PARSE_NOBLANKS=256]="XML_PARSE_NOBLANKS",e[e.XML_PARSE_SAX1=512]="XML_PARSE_SAX1",e[e.XML_PARSE_XINCLUDE=1024]="XML_PARSE_XINCLUDE",e[e.XML_PARSE_NONET=2048]="XML_PARSE_NONET",e[e.XML_PARSE_NODICT=4096]="XML_PARSE_NODICT",e[e.XML_PARSE_NSCLEAN=8192]="XML_PARSE_NSCLEAN",e[e.XML_PARSE_NOCDATA=16384]="XML_PARSE_NOCDATA",e[e.XML_PARSE_NOXINCNODE=32768]="XML_PARSE_NOXINCNODE",e[e.XML_PARSE_COMPACT=65536]="XML_PARSE_COMPACT",e[e.XML_PARSE_OLD10=131072]="XML_PARSE_OLD10",e[e.XML_PARSE_NOBASEFIX=262144]="XML_PARSE_NOBASEFIX",e[e.XML_PARSE_HUGE=524288]="XML_PARSE_HUGE",e[e.XML_PARSE_OLDSAX=1048576]="XML_PARSE_OLDSAX",e[e.XML_PARSE_IGNORE_ENC=2097152]="XML_PARSE_IGNORE_ENC",e[e.XML_PARSE_BIG_LINES=4194304]="XML_PARSE_BIG_LINES",e[e.XML_PARSE_NO_XXE=8388608]="XML_PARSE_NO_XXE",e[e.XML_PARSE_UNZIP=16777216]="XML_PARSE_UNZIP",e[e.XML_PARSE_NO_SYS_CATALOG=33554432]="XML_PARSE_NO_SYS_CATALOG",e[e.XML_PARSE_CATALOG_PI=67108864]="XML_PARSE_CATALOG_PI"})(m||(m={}));class d extends G{}function I(e,l,E,_){const n=_.option??m.XML_PARSE_DEFAULT,A=j(),t=L.storage.allocate([]);w(A,L.errorCollector,t);const r=e(A,l,E,null,n);try{const S=L.storage.get(t);if(S.length>0)throw r||M(r),new d(S.map(c=>c.message).join(""),S)}finally{L.storage.free(t),F(A)}if(!r)throw new d("Failed to parse XML",[]);const o=C.getInstance(r);return n&m.XML_PARSE_XINCLUDE&&o.processXInclude(),o}function ee(e){const l=D(e);l&&h.peekInstance(l)?.dispose(),M(e)}let C=(()=>{let e=[$(ee)],l,E=[],_,n=O;var A=_=class extends n{static create(){return A.getInstance(B())}static fromString(t,r={}){return I(H,t,r.url??null,r)}static fromBuffer(t,r={}){return I(k,t,r.url??null,r)}toString(t){const r=new p;return this.save(r,t),r.result}toBuffer(t,r){return this.save(t,r)}save(t,r){const o=Y(t,null,K(r));if(r?.indentString&&W(o,r.indentString)<0)throw new N("Failed to set indent string");z(o,this._ptr),V(o)}get(t,r){return this.root.get(t,r)}find(t,r){return this.root.find(t,r)}eval(t,r){return this.root.eval(t,r)}get dtd(){const t=D(this._ptr);return t?h.getInstance(t):null}get root(){const t=y(this._ptr);if(!t)throw new N;return new g(t)}set root(t){const r=P(this._ptr,t._nodePtr);r&&b(r)}createRoot(t,r,o){const S=U(this._ptr,0,t),c=new g(S);return r&&(c.addNsDeclaration(r,o),c.namespacePrefix=o??""),this.root=c,c}processXInclude(){const t=L.storage.allocate([]),r=q(this._ptr);Q(r,L.errorCollector,t);try{const o=J(r,this._ptr);if(o<0){const S=L.storage.get(t);throw new d(S.map(c=>c.message).join(""),S)}return o}finally{L.storage.free(t),Z(r)}}};return x(_,"XmlDocument"),(()=>{const t=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;T(null,l={value:_},e,{kind:"class",name:_.name,metadata:t},null,E),A=_=l.value,t&&Object.defineProperty(_,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:t}),v(_,E)})(),A=_})();export{m as ParseOption,C as XmlDocument,d as XmlParseError};
