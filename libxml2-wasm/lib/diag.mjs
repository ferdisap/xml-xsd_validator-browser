const n={trackAllocate(){},trackDeallocate(){},report(){}};function o(a){const{stack:t}=new Error;if(!t)return;let e=0;for(let s=a+2;s>0;s-=1)e=t.indexOf(`
`,e)+1;return t.substring(e)}class i{constructor(t,e){this.callerDetail=t,this.callerStats=e,this.idCounter=0,this.disposableId=new WeakMap,this.disposableInfo=new Map}trackAllocate(t){this.idCounter+=1,this.disposableId.set(t,this.idCounter);const e={object:new WeakRef(t),classname:t.constructor.name};(this.callerDetail||this.callerStats)&&(e.callstack=o(2)),this.disposableInfo.set(this.idCounter,e)}trackDeallocate(t){const e=this.disposableId.get(t);e&&(this.disposableInfo.delete(e),this.disposableId.delete(t))}report(){const t={};return this.disposableInfo.forEach(e=>{const s=t[e.classname]||={garbageCollected:0,totalInstances:0,instances:[]};s.totalInstances+=1;const r=e.object.deref();if(r!=null){const l={instance:r};this.callerDetail&&(l.caller=e.callstack),s.instances.push(l)}else s.garbageCollected+=1;if(this.callerStats){const l=s.callers||={};l[e.callstack]=(l[e.callstack]||0)+1}}),t}}function d(a){a.enabled?c=new i(a.callerDetail===!0,a.callerStats===!0):c=n}function u(){return c.report()}let c=n;function p(){return c}export{d as configure,u as report,p as tracker};
