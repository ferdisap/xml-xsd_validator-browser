import"./disposeShim.mjs";import"./metadataShim.mjs";import{tracker as o}from"./diag.mjs";const i=Symbol("XmlDisposableInternal");function p(a){return function(e,n){n.metadata[i]={instances:new Map,finalization:new FinalizationRegistry(a),free:a}}}class h{constructor(t){this._ptr=t,o().trackAllocate(this)}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this._ptr===0)return;const e=this.constructor[Symbol.metadata][i];e.free(this._ptr),e.finalization.unregister(this),e.instances.delete(this._ptr),o().trackDeallocate(this),this._ptr=0}static getInstance(t,...e){const n=this.peekInstance(t);if(n)return n;const r=this.getDisposableInternal(),s=new this(t,...e);return r.instances.set(t,new WeakRef(s)),r.finalization.register(s,t,s),s}static peekInstance(t){const n=this.getDisposableInternal().instances.get(t);return n&&n.deref()||null}static getDisposableInternal(){return this[Symbol.metadata][i]}}export{h as XmlDisposable,p as disposeBy};
